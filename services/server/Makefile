# Variables
PYTHON = python3
VENV = venv

# Commande pour vÃ©rifier si un environnement virtuel existe
VENV_EXISTS = [ -d $(VENV) ]

.PHONY: install run clean db embed

all: install run

## ğŸ“ 3. Installation complÃ¨te
install: clean
	@echo "ğŸ”§ CrÃ©ation et activation de l'environnement virtuel..."
	$(VENV_EXISTS) || $(PYTHON) -m venv $(VENV)
	@echo "âœ… Environnement virtuel crÃ©Ã© !"
	@echo "ğŸ“¦ Installation des dÃ©pendances..."
	. $(VENV)/bin/activate
	pip install -r requirements.txt
	make db
	@echo "âœ… Backend installÃ© !"

db:
	prisma db push --schema=libs/database/schema.prisma

embed:
	@echo "ğŸ“¦ Embedding documents..."
	flask embed-documents

## ğŸ“ 4. Lancer le backend (Flask)
run:
	@echo "ğŸš€ DÃ©marrage du backend..."
	FLASK_APP=app.py flask run --port 5000 --reload

## ğŸ“ 7. Nettoyer les fichiers inutiles
clean:
	@echo "ğŸ§¹ Nettoyage des fichiers temporaires..."
	rm -rf $(VENV)
	@echo "âœ… Nettoyage terminÃ© !"
